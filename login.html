<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Attendmark - Student Attendance</title>
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            primary: "#918BFF",
            "background-dark": "#1e1e1e",
            "surface-input-dark": "#2a2a2a",
            "peach": "#FFCBA4",
          },
          fontFamily: {
            display: ["Plus Jakarta Sans", "sans-serif"],
            sans: ["Inter", "sans-serif"],
          },
          borderRadius: {
            'xl': '0.75rem',
          },
        },
      },
    };
  </script>
  <link
    href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;600&family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap"
    rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=LINE+Seed+Sans:wght@400;500;600;700&display=swap"
    rel="stylesheet">
  <style>
    /* ================= GLOBAL & LANDING STYLES ================= */
    :root {
      --purple: #918BFF;
      --dark: #1F1A1C;
      --bg-landing: #f5f3ef;
      --bg-auth: #1e1e1e;
      --btn-bg: #3a3336;
      --arrow-bg: #8381fc;
      --text: #111;
      --accent: #8381fc;
      --item-h: 34px;
      --arrow-w: 26px;
      --ease: cubic-bezier(0.4, 0, 0.2, 1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    /* Utility hidden class (IMPORTANT: This ensures only one view shows) */
    .hidden {
      display: none !important;
    }

    body {
      font-family: 'Plus Jakarta Sans', sans-serif;
      background: var(--bg-landing);
      word-spacing: 0.1em;
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
      transition: background-color 0.8s ease;
    }

    body.auth-active {
      background: var(--bg-auth);
      overflow-y: auto !important;
      overflow-x: hidden;
    }

    /* ================= HEADER ================= */
    .header-container {
      position: relative;
      z-index: 4000;
      padding: 16px 16px 0 16px;
      transition: all 0.5s ease;
    }

    .title {
      font-size: 33px;
      font-weight: 750;
      line-height: 1.05;
      color: var(--btn-bg);
      transition: color 0.5s ease;
    }

    body.auth-active .title {
      color: #ffffff;
    }

    .with {
      position: absolute;
      top: 30px;
      left: 36px;
      font-family: 'Caveat', cursive;
      font-size: 30px;
      transform: rotate(-12deg);
      color: #918BFF;
    }

    .subtitle {
      margin-top: 6px;
      font-size: 8px;
      color: #444;
      text-transform: uppercase;
      letter-spacing: .12em;
      transition: color 0.5s ease;
    }

    body.auth-active .subtitle {
      color: #888;
    }

    .btn-text {
      word-spacing: 0.17em;
    }

    /* ================= STRIP ================= */
    .strip {
      margin-top: 25px;
      width: 100%;
      padding: 8px 0;
      background: #f8e6d8;
      border-top: 1px solid #f0c7a8;
      border-bottom: 1px solid #f0c7a8;
      overflow: hidden;
      position: relative;
      z-index: 2000;
    }

    .strip-track {
      display: flex;
      width: max-content;
      animation: stripMove 22s linear infinite;
      font-size: 11px;
      word-spacing: 0.4em;
      font-weight: 600;
      letter-spacing: .14em;
      text-transform: uppercase;
      color: #111;
    }

    .strip-track span {
      padding: 0 24px;
      white-space: nowrap;
    }

    @keyframes stripMove {
      from {
        transform: translateX(0);
      }

      to {
        transform: translateX(-50%);
      }
    }

    /* ================= MENU BUTTON ================= */
    .menu-btn {
      position: absolute;
      top: 36px;
      right: 16px;
      width: 32px;
      height: 12px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      cursor: pointer;
      z-index: 5000;
    }

    .menu-btn span {
      height: 3px;
      background: #353839;
      border-radius: 2.5px;
      transition: background 0.5s ease;
    }

    body.auth-active .menu-btn span {
      background: #ffffff;
    }

    .menu-dropdown {
      position: absolute;
      top: 60px;
      right: 15px;
      min-width: 180px;
      background: #fff;
      border: 1px solid #e3e3e3;
      border-radius: 12px;
      padding: 3px 0;
      box-shadow: 0 12px 32px rgba(0, 0, 0, .12);
      display: none;
      z-index: 6000;
    }

    .menu-dropdown a {
      display: block;
      padding: 12px 16px;
      font-size: 14px;
      color: #111;
      text-decoration: none;
      border-bottom: 1px solid #ededed;
    }

    .menu-dropdown a:last-child {
      border-bottom: none;
    }

    .menu-dropdown a:hover {
      background: #f6f6f6;
    }

    /* ================= VIEW TRANSITIONS ================= */
    #landing-view {
      opacity: 1;
      transform: translateY(0);
      transition: opacity 0.6s ease, transform 0.6s ease;
      padding: 0 16px 260px 16px;
    }

    #landing-view.hidden-view {
      opacity: 0;
      transform: translateY(-20px);
      pointer-events: none;
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      z-index: -1;
    }

    #auth-wrapper {
      opacity: 0;
      visibility: hidden;
      position: absolute;
      top: 42px;
      left: 0;
      width: 100%;
      height: calc(100vh - 42px);
      overflow-y: auto;
      padding-bottom: 40px;
      transition: opacity 0.8s ease 0.2s;
      z-index: 100;
    }

    #auth-wrapper.active-view {
      opacity: 1;
      visibility: visible;
      position: relative;
    }

    /* ================= LANDING UI ================= */
    .hero {
      display: flex;
      margin-top: 30px;
      justify-content: center;
      align-items: center;
    }

    .illustration {
      margin-left: -16px;
      margin-right: -16px;
      max-height: 36vh;
      width: 100%;
      display: flex;
      justify-content: center;
    }

    .illustration img {
      width: 100%;
      object-fit: contain;
    }

    .text-anim {
      position: relative;
      height: calc(var(--item-h) * 3);
      margin-top: 12px;
      overflow-y: hidden;
      overflow-x: visible;
    }

    .viewport {
      height: 100%;
      overflow-y: hidden;
      overflow-x: visible;
    }

    .list-center {
      position: relative;
      left: 50%;
      transform: translateX(-50%);
    }

    .list {
      position: absolute;
      left: 0;
      right: 0;
    }

    .item {
      position: relative;
      height: var(--item-h);
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'LINE Seed Sans', sans-serif;
      font-size: 1.35rem;
      word-spacing: 0.1em;
      font-weight: 500;
      white-space: nowrap;
      color: var(--text);
      opacity: 0.25;
      transition: transform .45s var(--ease), opacity .45s var(--ease), color .45s var(--ease), font-size .45s var(--ease);
    }

    .item.active {
      opacity: 1;
      color: var(--accent);
      font-weight: 600;
      font-size: 1.85rem;
    }

    .item.near {
      opacity: 0.55;
    }

    .fixed-arrow {
      position: absolute;
      top: 50%;
      width: var(--arrow-w);
      height: var(--arrow-w);
      transform: translateY(-50%);
      pointer-events: none;
    }

    .fixed-arrow svg {
      width: 100%;
      height: 100%;
      fill: none;
      stroke: var(--accent);
      stroke-width: 2.5;
    }

    .fixed-arrow.left {
      left: 0px;
    }

    .fixed-arrow.right {
      right: 0px;
      transform: translateY(-50%) rotate(180deg);
    }

    .cards-wrap {
      margin-top: 40px;
      padding: 22px;
      background: #efeee9;
      border: 1px solid #d8d6cf;
      border-radius: 26px;
    }

    .cards-title {
      text-align: center;
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 25px;
      margin-top: -8px;
    }

    .cards {
      display: grid;
      gap: 14px;
    }

    .card {
      background: #fff;
      border-radius: 18px;
      padding: 18px;
      border: 1px solid #e3e2dd;
    }

    .card h3 {
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 6px;
    }

    .card p {
      font-size: 13px;
      color: #666;
      line-height: 1.5;
    }

    .button-area {
      position: fixed;
      bottom: 16px;
      left: 0;
      right: 0;
      width: 100%;
      display: flex;
      justify-content: center;
      padding: 0 32px;
      z-index: 1000;
      transition: transform 0.5s ease, opacity 0.5s ease;
    }

    .button-area.hide-btn {
      transform: translateY(100px);
      opacity: 0;
      pointer-events: none;
    }

    .get-started {
      margin: 0 70px;
      position: relative;
      display: flex;
      align-items: center;
      height: 60px;
      padding-left: 24px;
      padding-right: 118px;
      background: var(--btn-bg);
      color: #fff;
      font-size: 22px;
      font-weight: 600;
      border-radius: 999px;
      text-decoration: none;
      box-shadow: 0 6px 18px rgba(0, 0, 0, .25);
      cursor: pointer;
    }

    .get-started .arrow-btn {
      position: absolute;
      top: 0;
      right: 0;
      width: 60px;
      height: 60px;
      background: var(--arrow-bg);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .get-started svg {
      width: 40px;
      height: 40px;
      stroke: #fff;
      stroke-width: 1.6;
      fill: none;
    }

    .footer {
      margin-top: 40px;
      text-align: center;
      font-size: 12px;
      color: #666;
      padding-bottom: 20px;
    }

    .footer-logos {
      margin-top: 10px;
      display: flex;
      justify-content: center;
      gap: 14px;
    }

    .footer-logos img {
      height: 18px;
      opacity: .85;
    }

    .footer-made {
      font-size: 15px;
      line-height: 1.4;
      font-weight: 500;
      color: #777;
    }

    /* ================= AUTH CUSTOM CSS ================= */
    .custom-input {
      transition: all 0.2s ease-in-out;
      outline: none;
    }

    .fade-in {
      animation: fadeIn 0.4s ease-out forwards;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .dark .text-gray-100 {
      color: #f3f4f6;
    }
  </style>

</head>

<body class="selection:bg-primary selection:text-white">

  <div class="header-container">
    <div class="title">Attendmark</div>
    <div class="title">Saar AI</div>
    <div class="with">with</div>
    <div class="subtitle">student academic & attendance responder</div>
    <div class="menu-btn"><span></span><span></span></div>
    <div class="menu-dropdown" id="menuDropdown">
      <a href="#">Terms & Privacy</a>
      <a href="#">Contact Creator</a>
    </div>
  </div>

  <div class="strip">
    <div class="strip-track">
      <span> A student self driven attendance tracker and a AI for college students. </span>
      <span> A student self driven attendance tracker and a AI for college students. </span>
    </div>
  </div>

  <div id="landing-view">
    <div class="hero">
      <div class="illustration"><img src="Image/30719.png" alt="Illustration" onerror="this.style.display='none'"></div>
    </div>
    <div class="text-anim">
      <div class="fixed-arrow left"><svg viewBox="0 0 24 24">
          <path d="M5 12h14M13 5l6 7-6 7" />
        </svg></div>
      <div class="viewport">
        <div class="list-center">
          <div class="list" id="list"></div>
        </div>
      </div>
      <div class="fixed-arrow right"><svg viewBox="0 0 24 24">
          <path d="M5 12h14M13 5l6 7-6 7" />
        </svg></div>
    </div>
    <section class="cards-wrap">
      <div class="cards-title">Built for ambitious students aiming</div>
      <div class="cards">
        <div class="card">
          <h3>Attendance clarity</h3>
          <p>Attendmark helps you to track & get real-time, and detailed attendance insights — so you can avoid
            last-minute confusion.</p>
        </div>
        <div class="card">
          <h3>AI academic help</h3>
          <p>SAAR AI help you to get simple, instant academic guidance to study smarter and plan better.</p>
        </div>
      </div>
    </section>
    <footer class="footer">
      <div>© Attendmark. All rights reserved.</div>
      <div class="footer-links" style="margin:6px 0;"><a href="#" style="color:#666; text-decoration:none;">Terms &
          Privacy</a></div>
      <div class="footer-made" style="margin-top:16px;">Made with ❤️ by a DCIAN<br> entirely using</div>
      <div class="footer-logos"><img src="Image/Ai3.webp" alt="ChatGPT"><img src="Image/Ai1.webp" alt="Claude"><img
          src="Image/Ai2.webp" alt="Gemini"></div>
    </footer>
  </div>

  <div class="button-area" id="getStartedBtnArea">
    <div class="get-started" id="getStartedBtn" role="button">
      Get&nbsp;Started
      <div class="arrow-btn"><svg viewBox="0 0 24 24">
          <path d="M7 17L17 7M9 7h8v8" />
        </svg></div>
    </div>
  </div>

  <div id="auth-wrapper" class="dark hidden">

    <div id="view-login"
      class="min-h-full flex flex-col items-center justify-start pt-0 px-6 transition-all duration-300">
      <div class="w-full flex-1 flex flex-col items-center max-w-sm">
        <div class="text-center mb-6 mt-2">
          <h1 class="font-display text-3xl font-extrabold tracking-tight text-gray-100 btn-text">Welcome mates</h1>
          <p class="text-[13px] text-gray-400 mt-1 font-medium">Please log in or sign up to continue</p>
        </div>
        <div class="w-full space-y-3 mb-4 relative">
          <button id="googleBtn" onclick="handleGoogleLogin()"
            class="w-full bg-white hover:bg-gray-200 text-black rounded-xl py-3.5 font-bold text-[16px] flex items-center justify-center gap-3 transition-all group btn-text">
            <svg class="w-5 h-5 group-hover:scale-110 transition-transform" viewBox="0 0 24 24">
              <path
                d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"
                fill="#4285F4"></path>
              <path
                d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"
                fill="#34A853"></path>
              <path
                d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"
                fill="#FBBC05"></path>
              <path
                d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"
                fill="#EA4335"></path>
            </svg>
            Continue with Google
          </button>

          <div class="flex items-center w-full gap-4 py-1">
            <div class="h-px bg-gray-700 flex-1"></div>
            <span class="text-xs text-gray-400 font-bold uppercase tracking-wider">or</span>
            <div class="h-px bg-gray-700 flex-1"></div>
          </div>

          <div class="relative group">
            <input
              class="custom-input w-full bg-surface-input-dark text-gray-100 rounded-xl py-3.5 pl-5 pr-14 placeholder-gray-300 btn-text focus:ring-2 focus:ring-primary/50 text-[16px]"
              id="emailInput" oninput="toggleArrow()" placeholder="Enter your gmail" type="email" />

            <div id="emailIconStatic" class="absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none">
              <svg class="w-5 h-5 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z">
                </path>
              </svg>
            </div>

            <button
              class="hidden absolute right-2 top-1/2 -translate-y-1/2 w-10 h-10 bg-white rounded-lg flex items-center justify-center hover:bg-gray-200 transition-colors cursor-pointer z-10"
              id="emailArrowBtn" onclick="checkEmailAndProceed()">
              <svg class="w-5 h-5 text-black" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" stroke-linecap="round" stroke-linejoin="round"></path>
              </svg>
            </button>
          </div>

          <div class="hidden relative group fade-in" id="passwordContainer">
            <input id="loginPassword"
              class="custom-input w-full bg-surface-input-dark text-gray-100 rounded-xl py-3.5 pl-5 pr-10 placeholder-gray-500 focus:ring-2 focus:ring-primary/50 text-[16px]"
              placeholder="Password" type="password" />

            <button type="button" onclick="togglePasswordVisibility('loginPassword')"
              class="absolute right-3 top-4 text-gray-500 hover:text-primary transition-colors cursor-pointer">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z">
                </path>
              </svg>
            </button>

            <div class="text-right mt-2 mr-1">
              <span onclick="switchAuthView('view-forgot'); switchToForgot();"
                class="text-[12px] text-primary hover:text-white cursor-pointer transition-colors font-medium">Forgot
                Password?</span>
            </div>
          </div>

          <button
            class="hidden fade-in w-full bg-primary text-white rounded-xl py-3.5 font-bold text-[16px] hover:bg-opacity-90 active:scale-[0.98] transition-all"
            onclick="handleEmailLogin()" id="continueBtn">Continue</button>
        </div>
        <div class="text-center text-xs text-gray-500 leading-relaxed px-4 pb-4">By continuing, you agree to our <a
            class="underline hover:text-primary" href="#">Terms</a> and <a class="underline hover:text-primary"
            href="#">Privacy Policy</a>.</div>
      </div>
    </div>

    <div id="view-forgot" class="hidden min-h-full flex flex-col items-center justify-start pt-0 px-6 fade-in">
      <div class="w-full flex-1 flex flex-col items-center max-w-sm">
        <div class="relative w-full flex items-center justify-center mb-8 mt-2">
          <button onclick="switchAuthView('view-login'); backToLogin('view-forgot')"
            class="absolute left-0 group flex items-center justify-center w-10 h-10 rounded-full hover:bg-white/10 transition-colors">
            <svg class="w-6 h-6 text-primary group-hover:-translate-x-0.5 transition-transform" fill="none"
              viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
            </svg>
          </button>
          <h1 class="font-display text-2xl font-extrabold tracking-tight text-gray-100">Reset Password</h1>
        </div>

        <div class="text-center mb-8">
          <p class="text-[13px] text-gray-400 font-medium mb-1">for account linked to</p>
          <p id="forgotEmailDisplay" class="font-sans text-lg font-bold text-white tracking-wide break-all"></p>
        </div>

        <div class="w-full space-y-6">
          <div id="forgotStateInitial" class="w-full space-y-5">
            <div class="bg-primary/10 border border-primary/30 rounded-xl p-3 text-center">
              <p class="text-[13px] text-primary font-semibold">A password reset link will be sent to this email
                address.</p>
            </div>

            <button onclick="sendResetLink()" id="btnSendReset"
              class="w-full bg-primary text-white rounded-xl py-3.5 font-bold text-[16px] hover:bg-opacity-90 active:scale-[0.98] transition-all btn-text">
              Send Link
            </button>
          </div>

          <div id="forgotStateSuccess"
            class="hidden w-full bg-green-500/10 border border-green-500/20 rounded-xl p-4 text-center">
            <div class="inline-flex items-center justify-center w-10 h-10 rounded-full bg-green-500/20 mb-2">
              <svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
              </svg>
            </div>
            <p class="text-[13px] text-gray-300">
              If an account exists, a link was sent to<br>
              <span id="sentEmailSpan" class="text-green-400 font-medium break-all"></span>
              <br><br>
              <span class="text-xs text-gray-400">Check your <b>Spam/Junk</b> folder!</span>
            </p>
          </div>
        </div>
      </div>
    </div>

    <div id="view-registration" class="hidden min-h-full flex flex-col relative px-6 pt-0 fade-in">
      <div class="w-full mb-6 mt-2 fade-in">
        <div class="relative w-full flex items-center justify-center mb-2 min-h-[28px]">
          <button onclick="handleRegistrationCancel()"
            class="absolute left-0 top-1/2 -translate-y-1/2 group flex items-center justify-center w-10 h-10 rounded-full hover:bg-white/10 transition-colors -ml-2 z-10">
            <svg class="w-6 h-6 text-gray-400 group-hover:-translate-x-0.5 transition-transform" fill="none"
              viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
            </svg>
          </button>
          <span class="text-peach text-[15px] font-medium text-center">Complete Setup</span>
        </div>

        <h1 class="font-display text-3xl font-bold tracking-tight text-white leading-tight text-center btn-text">Create
          Profile</h1>
      </div>

      <main class="flex-1 flex flex-col justify-start w-full max-w-sm mx-auto">
        <p class="text-[10px] text-gray-500 font-bold tracking-wider mb-2 ml-1">Fill all details correctly</p>

        <div class="grid grid-cols-2 gap-2">
          <div class="col-span-2">
            <div
              class="relative flex items-center bg-surface-input-dark/50 rounded-xl px-4 py-2.5 border border-dashed border-gray-700">
              <input id="regEmailInput"
                class="w-full bg-transparent border-none p-0 text-gray-500 text-sm font-medium focus:ring-0" disabled
                readonly value="" />
              <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z">
                </path>
              </svg>
            </div>
          </div>
          <div class="col-span-2">
            <input id="regFullName"
              class="custom-input w-full bg-surface-input-dark text-gray-100 rounded-xl py-2.5 px-4 placeholder-gray-500 focus:ring-2 focus:ring-primary/50 text-sm"
              placeholder="Full Name" type="text" />
          </div>

          <div class="col-span-1 relative">
            <select id="regCollege" onchange="onCollegeChange()"
              class="custom-input w-full bg-surface-input-dark rounded-xl py-2.5 pl-4 pr-8 text-sm text-gray-100 focus:ring-2 focus:ring-primary/50 cursor-pointer">
              <option value="" disabled selected class="text-gray-500">College</option>
              <!-- Options populated dynamically -->
            </select>
            <div class="absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none text-gray-500"><svg
                class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg></div>
          </div>

          <div class="col-span-1 relative">
            <select id="regClass" onchange="onClassChange()"
              class="custom-input w-full bg-surface-input-dark rounded-xl py-2.5 pl-4 pr-8 text-sm text-gray-100 focus:ring-2 focus:ring-primary/50 cursor-pointer"
              disabled>
              <option value="" disabled selected>Class</option>
              <!-- Options populated dynamically based on college -->
            </select>
            <div class="absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none text-gray-500"><svg
                class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg></div>
          </div>

          <div class="col-span-1 relative">
            <select id="regSection"
              class="custom-input w-full bg-surface-input-dark rounded-xl py-2.5 pl-4 pr-8 text-sm text-gray-100 focus:ring-2 focus:ring-primary/50 cursor-pointer"
              disabled>
              <option value="" disabled selected>Section</option>
              <!-- Options populated dynamically based on class -->
            </select>
            <div class="absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none text-gray-500"><svg
                class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg></div>
          </div>

          <div class="col-span-1">
            <input id="regRollNo"
              class="custom-input w-full bg-surface-input-dark text-gray-100 rounded-xl py-2.5 px-4 placeholder-gray-500 focus:ring-2 focus:ring-primary/50 text-sm"
              placeholder="Roll No." type="tel" />
          </div>

          <div class="col-span-2 relative" id="regPasswordContainer">
            <input id="regPassword"
              class="custom-input w-full bg-surface-input-dark text-gray-100 rounded-xl py-2.5 px-4 placeholder-gray-500 focus:ring-2 focus:ring-primary/50 text-sm"
              placeholder="Create Password" type="password" />
            <button type="button" onclick="togglePasswordVisibility('regPassword')"
              class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-primary transition-colors cursor-pointer">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z">
                </path>
              </svg>
            </button>
          </div>
        </div>

        <div class="mt-4 mb-2">
          <button id="completeRegBtn" onclick="initiateRegistration()"
            class="w-full bg-primary text-white rounded-xl py-3.5 font-bold text-[16px] hover:bg-opacity-90 active:scale-[0.98] transition-all flex items-center justify-center gap-2 btn-text">
            <span>Complete Registration</span>
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
            </svg>
          </button>
        </div>

        <div class="text-center text-[11px] text-gray-500 mt-2 mb-8">
          By clicking "Complete Registration", you agree to our <a href="#" class="underline hover:text-gray-300">Terms
            of Service</a> and <a href="#" class="underline hover:text-gray-300">Privacy Policy</a>.
        </div>
      </main>

    </div>

    <div id="view-verify-email"
      class="hidden min-h-full flex flex-col items-center justify-center px-6 fade-in text-center relative">
      <div class="absolute top-6 left-6">
        <button onclick="cancelVerification()" class="text-gray-400 text-sm underline">Cancel/Logout</button>
      </div>
      <div class="bg-primary/20 p-4 rounded-full mb-4">
        <svg class="w-8 h-8 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z">
          </path>
        </svg>
      </div>
      <h2 class="text-2xl font-bold text-white mb-2">Verify your Email</h2>
      <p class="text-gray-400 text-sm mb-6 max-w-xs">
        We've sent a verification link to <span id="verifyEmailDisplay" class="text-primary font-medium"></span>.
      </p>
      <div class="bg-surface-input-dark p-4 rounded-xl border border-gray-700 w-full max-w-xs mb-6">
        <div class="flex items-center justify-center space-x-2">
          <div class="w-2 h-2 bg-primary rounded-full animate-pulse"></div>
          <span class="text-xs text-gray-300 font-medium">Waiting for you to click the link...</span>
        </div>
      </div>
      <p class="text-[10px] text-gray-500">Once verified, we'll create your account automatically.</p>
    </div>

  </div>


  <script type="module">
    // --- FIREBASE IMPORTS ---
    import { auth, db, googleProvider } from "./firebase-init.js";
    import {
      signInWithPopup,
      fetchSignInMethodsForEmail,
      signInWithEmailAndPassword,
      createUserWithEmailAndPassword,
      onAuthStateChanged,
      sendPasswordResetEmail,
      EmailAuthProvider,
      linkWithCredential,
      signOut,
      sendEmailVerification,
      updateProfile,
      getAdditionalUserInfo
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import {
      doc,
      getDoc,
      setDoc,
      serverTimestamp,
      deleteDoc,
      addDoc,
      collection
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // --- ROUTINE SERVICE IMPORTS ---
    import {
      fetchMasterSheet,
      getClassesForCollege,
      getSectionsForClass,
      saveUserClassId
    } from './routine-service.js';

    // Globals
    let verificationInterval = null;
    const STATE_KEY = 'attendmark_pending_reg';
    let lastFetchMethodsTs = 0;
    const FETCH_MIN_INTERVAL_MS = 1500;
    window.pendingCredential = null;

    // Master Sheet Data Cache
    let masterSheetData = [];
    let masterSheetLoaded = false;

    // DOM Refs

    // ===== FIX 2: Cleanup interrupted registration state =====
    const pendingId = sessionStorage.getItem(STATE_KEY);

    if (pendingId && !auth.currentUser) {
      // Registration was interrupted (tab killed / app backgrounded)
      sessionStorage.removeItem(STATE_KEY);
    }
    const emailInput = document.getElementById('emailInput');
    const emailArrowBtn = document.getElementById('emailArrowBtn');
    const emailIconStatic = document.getElementById('emailIconStatic');
    const passwordContainer = document.getElementById('passwordContainer');
    const continueBtn = document.getElementById('continueBtn');
    const loginPassword = document.getElementById('loginPassword');
    const regPasswordContainer = document.getElementById('regPasswordContainer');
    const regEmailInput = document.getElementById('regEmailInput');
    const regFullName = document.getElementById('regFullName');
    const completeRegBtn = document.getElementById('completeRegBtn');
    const regCollegeSelect = document.getElementById('regCollege');
    const regClassSelect = document.getElementById('regClass');
    const regSectionSelect = document.getElementById('regSection');

    // --- DYNAMIC DROPDOWN POPULATION ---
    async function loadMasterSheetData() {
      if (masterSheetLoaded) return masterSheetData;

      try {
        console.log('Fetching master sheet for registration form...');
        masterSheetData = await fetchMasterSheet();
        masterSheetLoaded = true;
        return masterSheetData;
      } catch (err) {
        console.warn('Failed to load master sheet:', err);
        return [];
      }
    }

    async function populateColleges() {
      const data = await loadMasterSheetData();

      if (!data || data.length === 0) {
        // Fallback: Add a default option for manual entry
        console.log('No master data - using fallback colleges');
        regCollegeSelect.innerHTML = `
          <option value="" disabled selected class="text-gray-500">College</option>
          <option value="dispur-college">Dispur College</option>
          <option value="other">Other</option>
        `;
        return;
      }

      // Extract unique colleges
      const colleges = [...new Set(data.map(row => row.college_id).filter(c => c))];

      regCollegeSelect.innerHTML = '<option value="" disabled selected class="text-gray-500">College</option>';
      colleges.forEach(collegeId => {
        // Create display name from ID (capitalize, replace dashes with spaces)
        const displayName = collegeId.split('-').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ');
        const option = document.createElement('option');
        option.value = collegeId;
        option.textContent = displayName;
        regCollegeSelect.appendChild(option);
      });
    }

    window.onCollegeChange = async function () {
      const selectedCollege = regCollegeSelect.value;

      // Reset and disable downstream dropdowns
      regClassSelect.innerHTML = '<option value="" disabled selected>Class</option>';
      regSectionSelect.innerHTML = '<option value="" disabled selected>Section</option>';
      regClassSelect.disabled = true;
      regSectionSelect.disabled = true;

      if (!selectedCollege) return;

      try {
        const classes = await getClassesForCollege(selectedCollege);

        if (classes.length === 0) {
          // Fallback
          regClassSelect.innerHTML = `
            <option value="" disabled selected>Class</option>
            <option value="default">Enter manually in setup</option>
          `;
          regClassSelect.disabled = false;
          return;
        }

        regClassSelect.innerHTML = '<option value="" disabled selected>Class</option>';
        classes.forEach(row => {
          const option = document.createElement('option');
          option.value = row.class_id;
          option.textContent = row.class_label || row.class_id;
          option.dataset.sections = row.sections_available || 'A,B,C';
          regClassSelect.appendChild(option);
        });
        regClassSelect.disabled = false;

      } catch (err) {
        console.warn('Failed to load classes:', err);
        regClassSelect.disabled = false;
      }
    }

    window.onClassChange = async function () {
      const selectedClassId = regClassSelect.value;

      // Reset section dropdown
      regSectionSelect.innerHTML = '<option value="" disabled selected>Section</option>';
      regSectionSelect.disabled = true;

      if (!selectedClassId) return;

      try {
        const sections = await getSectionsForClass(selectedClassId);

        sections.forEach(section => {
          const option = document.createElement('option');
          option.value = section.toLowerCase();
          option.textContent = section;
          regSectionSelect.appendChild(option);
        });
        regSectionSelect.disabled = false;

        // Save class ID for later use
        saveUserClassId(selectedClassId);

      } catch (err) {
        console.warn('Failed to load sections:', err);
        // Fallback sections
        ['A', 'B', 'C'].forEach(s => {
          const option = document.createElement('option');
          option.value = s.toLowerCase();
          option.textContent = s;
          regSectionSelect.appendChild(option);
        });
        regSectionSelect.disabled = false;
      }
    }

    // Load colleges when page is ready
    document.addEventListener('DOMContentLoaded', () => {
      populateColleges();
    });

    // Expose to window 
    window.checkEmailAndProceed = checkEmailAndProceed;
    window.handleEmailLogin = handleEmailLogin;
    window.initiateRegistration = initiateRegistration;
    window.sendResetLink = sendResetLink;
    window.handleGoogleLogin = handleGoogleLogin;
    window.handleRegistrationCancel = handleRegistrationCancel;
    window.cancelVerification = cancelVerification;
    window.switchAuthView = switchAuthView;

    // --- VIEW SWITCHER HELPER (FIXES UI BREAKS) ---
    function switchAuthView(viewId) {
      // 1. Activate Main Wrapper
      document.getElementById('landing-view').classList.add('hidden-view');
      document.getElementById('landing-view').classList.add('hidden');
      document.getElementById('auth-wrapper').classList.remove('hidden');
      document.getElementById('auth-wrapper').classList.add('active-view');
      document.body.classList.add('auth-active');
      document.getElementById('getStartedBtnArea').classList.add('hide-btn');

      // 2. Hide ALL sub-views
      const views = ['view-login', 'view-forgot', 'view-registration', 'view-verify-email'];
      views.forEach(id => {
        document.getElementById(id).classList.add('hidden');
      });

      // 3. Show TARGET view
      const target = document.getElementById(viewId);
      target.classList.remove('hidden');

      // Ensure flex alignment if needed
      document.getElementById('auth-wrapper').style.alignItems = (viewId === 'view-registration') ? 'flex-start' : 'center';
    }

    // --- HELPERS ---
    function encodeEmailAsId(email) {
      return encodeURIComponent(email.toLowerCase());
    }

    async function logAuthEvent(type, payload = {}) {
      try {
        await addDoc(collection(db, 'auth_logs'), { type, payload, ts: serverTimestamp() });
      } catch (e) { console.warn('Logging failed', e); }
    }

    async function savePendingProfileToFirestore(email, data) {
      try {
        const id = encodeEmailAsId(email);
        await setDoc(doc(db, 'pending_regs', id), {
          email: email.toLowerCase(),
          data,
          createdAt: serverTimestamp()
        }, { merge: true });
        sessionStorage.setItem(STATE_KEY, id);
        return id;
      } catch (e) { console.error('Failed to write pending profile', e); return null; }
    }

    async function removePendingProfile(emailOrId) {
      try {
        const id = (emailOrId || '').includes('%40') ? emailOrId : encodeEmailAsId(emailOrId || '');
        if (!id) return;
        await deleteDoc(doc(db, 'pending_regs', id));
        sessionStorage.removeItem(STATE_KEY);
      } catch (e) { console.warn('Failed to remove pending profile', e); }
    }

    async function getPendingProfileByEmail(email) {
      try {
        const id = encodeEmailAsId(email);
        const snap = await getDoc(doc(db, 'pending_regs', id));
        if (snap.exists()) return snap.data();
        return null;
      } catch (e) { console.warn('Failed to read pending profile', e); return null; }
    }

    async function saveUserProfile(uid, data) {
      const userRef = doc(db, "users", uid);
      try {
        const existing = await getDoc(userRef);
        if (existing.exists()) {
          const existingData = existing.data();
          const payload = { ...existingData, ...data, updatedAt: serverTimestamp() };
          if (!existingData.createdAt) payload.createdAt = serverTimestamp();
          await setDoc(userRef, payload, { merge: true });
        } else {
          await setDoc(userRef, { ...data, profileComplete: true, createdAt: serverTimestamp(), updatedAt: serverTimestamp() }, { merge: true });
        }
      } catch (e) { console.error('Failed to save user profile', e); throw e; }
    }

    // --- GATEKEEPER LOGIC ---
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        // 1. Check Verification (Google considered verified)
        const isGoogle = user.providerData.some(p => p.providerId === 'google.com');
        const isVerified = user.emailVerified || isGoogle;

        if (!isVerified) {
          switchAuthView('view-verify-email');
          document.getElementById('verifyEmailDisplay').innerText = user.email || '';
          startVerificationListener(user);
          return;
        }

        // 2. Check Profile Completeness
        try {
          const userRef = doc(db, "users", user.uid);
          const userSnap = await getDoc(userRef);
          if (userSnap.exists() && userSnap.data().profileComplete === true) {
            window.location.replace("index.html");
          } else {
            // SHOW REGISTRATION (Existing Auth, No Profile)
            switchAuthView('view-registration');
            await setupRegistrationScreenValues(user);
          }
        } catch (err) {
          console.error("Profile check error:", err);
          alert("Connection error. Please check your internet.");
        }
      }
    });

    async function setupRegistrationScreenValues(user) {
      if (user.email) regEmailInput.value = user.email;
      if (user.displayName) regFullName.value = user.displayName;

      const hasPassword = user.providerData.some(p => p.providerId === 'password');
      if (hasPassword) {
        regPasswordContainer.classList.add('hidden');
      } else {
        regPasswordContainer.classList.remove('hidden');
      }
    }

    // --- GOOGLE LOGIN ---
    async function handleGoogleLogin() {
      const btn = document.getElementById('googleBtn');
      const originalContent = btn.innerHTML;

      try {
        btn.disabled = true;
        btn.innerHTML = `
          <div class="w-5 h-5 border-2 border-gray-600 border-t-transparent rounded-full animate-spin"></div>
          <span class="opacity-70">Signing in...</span>
        `;
        btn.classList.add('opacity-70', 'cursor-not-allowed');

        const result = await signInWithPopup(auth, googleProvider);
        // Success: onAuthStateChanged will handle redirect.
        // We keep it disabled to prevent double-clicks during redirect.
      } catch (error) {
        console.error('Google sign-in error', error);

        // Re-enable button on error
        btn.disabled = false;
        btn.innerHTML = originalContent;
        btn.classList.remove('opacity-70', 'cursor-not-allowed');

        const code = error && error.code;
        if (code === 'auth/popup-closed-by-user' || code === 'auth/cancelled-popup-request') {
          // User closed popup, minimal feedback needed
          return;
        }

        const conflictEmail = (error && (error.customData && error.customData.email)) || (error && error.email) || null;

        try { window.pendingCredential = googleProvider.credentialFromError ? googleProvider.credentialFromError(error) : null; } catch (e) { window.pendingCredential = null; }

        if (code === 'auth/account-exists-with-different-credential') {
          await logAuthEvent('provider_conflict', { email: conflictEmail, code });
          let methods = [];
          try { if (conflictEmail) methods = await fetchSignInMethodsForEmail(auth, conflictEmail); } catch (e) { console.warn('Could not fetch methods', e); }

          if (methods && methods.length) {
            if (conflictEmail) {
              emailInput.value = conflictEmail;
              if (methods.includes('password')) {
                document.getElementById('passwordContainer').classList.remove('hidden');
                document.getElementById('continueBtn').classList.remove('hidden');
                emailIconStatic.classList.add('hidden');
                alert('This email is registered via Password. Please sign in to link Google.');
                return;
              } else {
                alert('Sign in using: ' + methods.join(', '));
                return;
              }
            }
          }
        }

        if (code === 'auth/unauthorized-domain') {
          alert('Setup Error: This domain (' + window.location.hostname + ') is not authorized in Firebase Console.\n\nGo to Firebase Console -> Authentication -> Settings -> Authorized Domains and add this domain.');
          return;
        }

        alert('Google sign-in failed: ' + (error.message || code));
      }
    }

    // --- CANCEL REGISTRATION ---
    async function handleRegistrationCancel() {
      try {
        await signOut(auth);
        sessionStorage.removeItem(STATE_KEY);
      } catch (e) { console.error(e); }
      window.location.reload();
    }

    // --- CHECK EMAIL ---
    async function checkEmailAndProceed() {
      const emailValue = emailInput.value.trim();
      if (!emailValue) return;

      const now = Date.now();
      if (now - lastFetchMethodsTs < FETCH_MIN_INTERVAL_MS) {
        await new Promise(r => setTimeout(r, FETCH_MIN_INTERVAL_MS - (now - lastFetchMethodsTs)));
      }
      lastFetchMethodsTs = Date.now();

      const arrowBtn = emailArrowBtn;
      const originalContent = arrowBtn.innerHTML;
      arrowBtn.innerHTML = '<div class="w-4 h-4 border-2 border-black border-t-transparent rounded-full animate-spin"></div>';
      arrowBtn.disabled = true;

      try {
        let methods = [];
        try { methods = await fetchSignInMethodsForEmail(auth, emailValue); }
        catch (err) { methods = []; }

        await new Promise(r => setTimeout(r, 400));

        if (methods.length === 0) {
          // New User -> Switch to Registration View cleanly
          document.getElementById('regEmailInput').value = emailValue;
          switchAuthView('view-registration');
          regPasswordContainer.classList.remove('hidden');
        } else {
          // Existing User -> Stay on Login, show password
          emailIconStatic.classList.add('hidden');
          emailArrowBtn.classList.add('hidden');
          passwordContainer.classList.remove('hidden');
          continueBtn.classList.remove('hidden');
          loginPassword.focus();
        }

      } catch (error) {
        console.error(error);
        alert("Network error. Please try again.");
      } finally {
        arrowBtn.innerHTML = originalContent;
        arrowBtn.disabled = false;
      }
    }

    // --- EMAIL LOGIN ---
    async function handleEmailLogin() {
      const email = emailInput.value.trim();
      const password = loginPassword.value;
      if (!password) { alert("Please enter password"); return; }

      const btn = continueBtn;
      btn.textContent = "Verifying..."; btn.disabled = true;

      try {
        const credential = await signInWithEmailAndPassword(auth, email, password);
        if (window.pendingCredential) {
          try {
            await linkWithCredential(auth.currentUser, window.pendingCredential);
            window.pendingCredential = null;
          } catch (e) { console.warn('Linking failed', e); }
        }
      } catch (error) {
        console.error(error);
        alert("Invalid credentials. Please try again.");
        btn.textContent = "Continue"; btn.disabled = false;
      }
    }

    // --- REGISTRATION LOGIC ---
    async function initiateRegistration() {
      const fullName = document.getElementById('regFullName').value.trim();
      const college = document.getElementById('regCollege').value;
      const course = document.getElementById('regClass').value;
      const section = document.getElementById('regSection').value;
      const rollNo = document.getElementById('regRollNo').value.trim();
      const password = document.getElementById('regPassword').value;
      const email = document.getElementById('regEmailInput').value.trim();

      if (!fullName || !college || !course || !section || !rollNo) {
        alert("Please fill all fields."); return;
      }
      if (!/^\d+$/.test(rollNo)) {
        alert("Roll Number must contain only digits."); return;
      }

      const btn = completeRegBtn;
      const originalText = btn.innerHTML;
      btn.innerHTML = 'Processing...'; btn.disabled = true;

      try {
        let user = auth.currentUser;

        // Get the display label for class (for profile display)
        const classOption = regClassSelect.options[regClassSelect.selectedIndex];
        const classLabel = classOption ? classOption.textContent : course;

        const profileData = {
          name: fullName,
          college,
          course_or_class: classLabel, // Display label
          class_id: course, // ID for routine lookup
          section,
          rollNumber: rollNo,
          email: email.toLowerCase(),
          profileComplete: true
        };

        if (!user) {
          if (!password || password.length < 6) {
            alert("Password must be at least 6 characters.");
            btn.innerHTML = originalText; btn.disabled = false; return;
          }
          await savePendingProfileToFirestore(email, profileData);
          const credential = await createUserWithEmailAndPassword(auth, email, password);
          user = credential.user;
          await updateProfile(user, { displayName: fullName }).catch(e => console.log(e));
          await sendEmailVerification(user);

          document.getElementById('verifyEmailDisplay').innerText = email;
          switchAuthView('view-verify-email');
          startVerificationListener(user);
        }
        else {
          if (password) {
            if (password.length < 6) {
              alert("Password must be at least 6 characters.");
              btn.innerHTML = originalText; btn.disabled = false; return;
            }
            try {
              const cred = EmailAuthProvider.credential(user.email, password);
              await linkWithCredential(user, cred);
            } catch (e) { console.warn('Link error', e); }
          }
          await saveUserProfile(user.uid, profileData);
          await removePendingProfile(email);
          window.location.replace("index.html");
        }

      } catch (error) {
        console.error("Reg Error:", error);
        alert("Registration failed: " + (error.message || error));
        btn.innerHTML = originalText; btn.disabled = false;
      }
    }

    // --- LISTENER with RECOVERY ---
    function startVerificationListener(user) {
      if (verificationInterval) clearInterval(verificationInterval);
      verificationInterval = setInterval(async () => {
        try {
          await user.reload();
          if (user.emailVerified) {
            clearInterval(verificationInterval);
            let dataToSave = null;
            const email = (user && user.email) ? user.email.toLowerCase() : null;
            if (email) {
              const pending = await getPendingProfileByEmail(email);
              if (pending && pending.data) dataToSave = pending.data;
            }
            if (!dataToSave) {
              alert("Email verified! Please confirm your details to finish setup.");
              window.location.reload();
              return;
            }
            await saveUserProfile(user.uid, dataToSave);
            await removePendingProfile(user.email);
            sessionStorage.removeItem(STATE_KEY);
            alert("Verification Successful!");
            window.location.replace("index.html");
          }
        } catch (e) { console.log(e); }
      }, 3000);
    }

    async function cancelVerification() {
      if (verificationInterval) clearInterval(verificationInterval);
      sessionStorage.removeItem(STATE_KEY);
      await signOut(auth);
      window.location.reload();
    }

    async function sendResetLink() {
      let email = document.getElementById('forgotEmailDisplay').innerText.trim();
      if (!email) return;

      const btn = document.getElementById('btnSendReset');
      const originalText = btn.innerText;
      btn.innerText = "Sending..."; btn.disabled = true;

      try { await sendPasswordResetEmail(auth, email); } catch (error) { console.error(error); }

      document.getElementById('sentEmailSpan').textContent = email;
      document.getElementById('forgotStateInitial').classList.add('hidden');
      document.getElementById('forgotStateSuccess').classList.remove('hidden');
      btn.innerText = originalText; btn.disabled = false;
    }
  </script>

  <script>
    /* ================= UI INTERACTION SCRIPTS ================= */
    const baseLabels = ["Track  attendance", "Get  detailed  stats", "Subjects  analytics", "Plan  safebunks", "Tips  &  roadmap", "Ask  doubts  to  AI", "Log  short  notes", "Realtime  counts", "View  edit  anytime", "College  friendly"];
    const labels = Array.from({ length: 20 }, () => baseLabels).flat();
    const list = document.getElementById("list");

    labels.forEach(text => {
      const el = document.createElement("div");
      el.className = "item";
      el.textContent = text;
      list.appendChild(el);
    });

    const items = [...document.querySelectorAll(".item")];
    let index = 1;
    function render() {
      const h = 34;
      list.style.transform = `translateY(${-(index - 1) * h}px)`;
      items.forEach((el, i) => {
        el.classList.remove("active", "near");
        if (Math.abs(i - index) === 0) el.classList.add("active");
        else if (Math.abs(i - index) === 1) el.classList.add("near");
      });
    }

    function step() {
      if (index >= labels.length - 2) { clearInterval(timer); return; }
      index++;
      list.style.transition = `transform 500ms cubic-bezier(0.4,0,0.2,1)`;
      render();
    }

    render();
    const timer = setInterval(step, 1200);

    // Menu
    const menuBtn = document.querySelector(".menu-btn");
    const menuDropdown = document.getElementById("menuDropdown");
    menuBtn.addEventListener("click", e => {
      e.stopPropagation();
      menuDropdown.style.display = menuDropdown.style.display === "block" ? "none" : "block";
    });
    document.addEventListener("click", () => { menuDropdown.style.display = "none"; });

    // View Transition
    const getStartedBtn = document.getElementById('getStartedBtn');
    function transitionToAuth() {
      window.switchAuthView('view-login');
    }
    getStartedBtn.addEventListener('click', transitionToAuth);

    // Input Logic
    function toggleArrow() {
      const emailInput = document.getElementById('emailInput');
      const arrowBtn = document.getElementById('emailArrowBtn');
      const emailIcon = document.getElementById('emailIconStatic');
      const passwordContainer = document.getElementById('passwordContainer');

      if (!emailInput.disabled) {
        if (emailInput.value.trim().length > 0 && passwordContainer.classList.contains('hidden')) {
          arrowBtn.classList.remove('hidden');
          emailIcon.classList.add('hidden');
        } else {
          if (passwordContainer.classList.contains('hidden')) {
            arrowBtn.classList.add('hidden');
            emailIcon.classList.remove('hidden');
          }
        }
      }
    }

    function togglePasswordVisibility(id) {
      const input = document.getElementById(id);
      input.type = input.type === "password" ? "text" : "password";
    }

    function switchToForgot() {
      const emailValue = document.getElementById('emailInput').value.trim();
      document.getElementById('forgotEmailDisplay').innerText = emailValue || "No email provided";
      document.getElementById('forgotStateInitial').classList.remove('hidden');
      document.getElementById('forgotStateSuccess').classList.add('hidden');
      document.getElementById('btnSendReset').innerText = "Send Link";
      document.getElementById('btnSendReset').disabled = false;
    }

    function backToLogin(currentViewId) {
      document.getElementById('passwordContainer').classList.add('hidden');
      document.getElementById('continueBtn').classList.add('hidden');
      const emailInput = document.getElementById('emailInput');
      emailInput.disabled = false;
      toggleArrow();
    }
  </script>


</body>

</html>
