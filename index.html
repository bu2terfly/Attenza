<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="theme-color" content="#8b7cc8">
  <link rel="manifest" href="./manifest.json">
  <link rel="stylesheet" href="styles.css">
  <link rel="apple-touch-icon" href="./icons/icon-192.png">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Gaegu:wght@300;400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Cedarville+Cursive&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Cabin+Sketch:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <title>ATTENZA - for Dispur College</title>

  <style>
    /* keep initial hidden to avoid flash of unauth UI, but reveal robustly in JS */
    body { visibility: hidden; }
  </style>

  <!-- Robust Firebase + auth check using dynamic imports to avoid fatal freeze if imports fail -->
  <script type="module">
    (async () => {
      // Safety fallback: if nothing resolves in this timeout, reveal the page
      const revealTimeout = setTimeout(() => {
        try { document.body.style.visibility = 'visible'; } catch(e){ /* silent */ }
        console.warn('Auth check timeout â€” revealing UI as fallback.');
      }, 4000);

      try {
        // Use dynamic imports so a failure won't block the rest of the page
        const firebaseAppModule = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js');
        const firebaseAuthModule = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js');
        const firebaseFirestoreModule = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');

        const { initializeApp } = firebaseAppModule;
        const { getAuth, onAuthStateChanged } = firebaseAuthModule;
        const { getFirestore, doc, getDoc } = firebaseFirestoreModule;

        const firebaseConfig = {
          apiKey: "AIzaSyDbFEWKJylJJgNw0KIyFsDxlDKPwJII73o",
          authDomain: "attenza-app.firebaseapp.com",
          projectId: "attenza-app",
          storageBucket: "attenza-app.firebasestorage.app",
          messagingSenderId: "435010148378",
          appId: "1:435010148378:web:e5540806fd0ef90b16d9a3"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        onAuthStateChanged(auth, async (user) => {
          clearTimeout(revealTimeout);
          try {
            if (!user) {
              // if not logged in, redirect to login
              window.location.replace("login.html");
              return;
            }
            // Logged in -> check profile document
            const userRef = doc(db, "users", user.uid);
            const userSnap = await getDoc(userRef);

            if (userSnap.exists() && userSnap.data().profileComplete === true) {
              document.body.style.visibility = "visible";
            } else {
              // fallback for incomplete profile â€” return to login/registration
              window.location.replace("login.html");
            }
          } catch (err) {
            console.error('Auth check error:', err);
            // If something fails reading Firestore, reveal UI as a graceful fallback
            document.body.style.visibility = "visible";
          }
        }, (error) => {
          // onAuthStateChanged subscription error â€” reveal UI gracefully
          console.error('onAuthStateChanged error:', error);
          clearTimeout(revealTimeout);
          document.body.style.visibility = "visible";
        });

      } catch (err) {
        // If dynamic import fails, reveal the page so it doesn't stay frozen.
        console.error('Firebase dynamic import failed:', err);
        clearTimeout(revealTimeout);
        document.body.style.visibility = "visible";
      }
    })();
  </script>
</head>

<body>
  <div class="header" id="header">
    <div class="top-bar">
      <div class="left-section">
        <button id="openMenuBtn" class="icon-btn" aria-label="Menu">
          <div class="menu-mini"><span></span></div>
        </button>
        <div class="brand-container">
          <span class="brand-name">ATTENZA</span>
          <span class="tagline">a student driven attendance tracker</span>
        </div>
      </div>

      <button class="icon-btn notif-rev" aria-label="Notifications">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <path d="M12 5.365V3m0 2.365a5.338 5.338 0 0 1 5.133 5.368v1.8c0 2.386 1.867 2.982 1.867 4.175 0 .593 0 1.292-.538 1.292H5.538C5 18 5 17.301 5 16.708c0-1.193 1.867-1.789 1.867-4.175v-1.8A5.338 5.338 0 0 1 12 5.365ZM8.733 18c.094.852.306 1.54.944 2.112a3.48 3.48 0 0 0 4.646 0c.638-.572 1.236-1.26 1.33-2.112h-6.92Z" stroke-width="2.25" stroke-linejoin="round" stroke-linecap="round" stroke="currentColor"></path>
        </svg>
        <div class="notif-dot"></div>
      </button>
    </div>

    <div class="expand-section">
      <div class="expand-arrow" id="expandArrow">
        <svg viewBox="0 0 24 24" fill="none">
          <path d="M6 9l6 6 6-6" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>

      <div class="expanded-content" id="expandedContent">
        <div class="content-inner">
          <div class="info-section">
            <h3>About ATTENZA</h3>
            <p>A student-driven attendance tracker designed exclusively for Dispur College students. View your attendance data anytime, anywhere - something our teacher-driven system doesn't allow.</p>
          </div>

          <div class="info-section">
            <h3>Key Features</h3>
            <div class="features">
              <div class="feature-card"><h4>ðŸ“Š Real-time Data</h4><p>Check your attendance percentage instantly</p></div>
              <div class="feature-card"><h4>ðŸ“… Subject-wise View</h4><p>Track attendance for each subject separately</p></div>
              <div class="feature-card"><h4>ðŸ”” Smart Alerts</h4><p>Get notified when attendance falls below threshold</p></div>
              <div class="feature-card"><h4>ðŸ“± Mobile Friendly</h4><p>Access from any device, anytime</p></div>
            </div>
          </div>

          <div class="info-section">
            <h3>How to Use</h3>
            <p>1. Log in with your college ID<br>2. View your dashboard with attendance summary<br>3. Click on any subject to see detailed records<br>4. Set alerts for attendance warnings</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="sketch-line-container">
    <span class="sketch-line"> I
      <svg class="sketch-heart" viewBox="0 0 120 120">
        <path d="M60 105 C20 70, 10 40, 30 25 C50 10, 70 20, 60 40 C80 10, 110 25, 90 50 C70 80, 60 95, 60 105 Z"/>
        <g stroke="#e63946" stroke-width="4" fill="none" stroke-linecap="round" stroke-linejoin="round" opacity="0.9">
          <path d="M35 60 Q 55 50 80 55" />
          <path d="M32 68 Q 55 60 85 64" />
          <path d="M34 76 Q 55 70 82 75" />
          <path d="M37 84 Q 58 78 79 82" />
          <path d="M45 45 Q 60 55 78 68" />
          <path d="M40 52 Q 55 64 75 78" />
          <path d="M50 70 Q 55 68 60 72" />
          <path d="M58 80 Q 63 78 68 82" />
        </g>
      </svg>
      Dispur College
    </span>
  </div>

  <div class="content-body">
    <div class="welcome-section">
      <div class="welcome-content">
        <div class="welcome-text-content">
          <h3 id="welcomeTitle">Hello, User!</h3>
          <p id="welcomeSubtitle">Great progress! Keep maintaining your attendance streak.</p>
          <div class="attendance-ring">
            <svg class="ring-svg" viewBox="0 0 160 160">
              <circle class="ring-bg-circle" cx="80" cy="80" r="70"></circle>
              <circle class="ring-progress-circle" cx="80" cy="80" r="70" id="progressCircle"></circle>
            </svg>
            <div class="ring-center">
              <span class="percentage" id="percentageText">75%</span>
              <span class="percentage-label">Overall</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="notebook-section">
      <div class="page">
        <img src="Image/your-logo.png" alt="Logo" class="note-logo">
        <div class="margin"></div>
        <p>Keep a quick note of important classes, make-up days or attendance targets here. This space can work like your personal college notebook page.</p>
        <div class="teacher-mark"><span class="teacher-sign">Principal</span></div>
      </div>
    </div>

    <div class="install-strip" id="installStrip">
      <div class="install-content">
        <span class="install-text" id="installText">Install this site as an app</span>
        <button class="close-strip" id="closeStrip" aria-label="Close install strip">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
    </div>

    <div class="section-header">
      <h3>Today's Schedule</h3>
      <a href="#" class="view-all">VIEW
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      </a>
    </div>

    <div class="carousel-container">
      <div class="carousel" id="carousel">
        <!-- class cards -->
        <div class="class-card">
          <div class="class-header">
            <span class="class-subject">Data Structures</span>
            <span class="class-time">09:00 AM</span>
          </div>
          <div class="class-details">
            <div><strong>Room:</strong> CS-301</div>
            <div><strong>Faculty:</strong> Dr. Smith</div>
            <div><strong>Duration:</strong> 1 hour</div>
          </div>
          <div class="attendance-actions">
            <button class="attendance-btn btn-attend">Attend</button>
            <button class="attendance-btn btn-skip">Skip</button>
            <button class="attendance-btn btn-not-held">Not Held</button>
          </div>
        </div>

        <div class="class-card">
          <div class="class-header">
            <span class="class-subject">Database Systems</span>
            <span class="class-time">11:00 AM</span>
          </div>
          <div class="class-details">
            <div><strong>Room:</strong> CS-205</div>
            <div><strong>Faculty:</strong> Prof. Johnson</div>
            <div><strong>Duration:</strong> 1.5 hours</div>
          </div>
          <div class="attendance-actions">
            <button class="attendance-btn btn-attend">Attend</button>
            <button class="attendance-btn btn-skip">Skip</button>
            <button class="attendance-btn btn-not-held">Not Held</button>
          </div>
        </div>

        <div class="class-card">
          <div class="class-header">
            <span class="class-subject">Web Development</span>
            <span class="class-time">02:00 PM</span>
          </div>
          <div class="class-details">
            <div><strong>Room:</strong> Lab-102</div>
            <div><strong>Faculty:</strong> Ms. Williams</div>
            <div><strong>Duration:</strong> 2 hours</div>
          </div>
          <div class="attendance-actions">
            <button class="attendance-btn btn-attend">Attend</button>
            <button class="attendance-btn btn-skip">Skip</button>
            <button class="attendance-btn btn-not-held">Not Held</button>
          </div>
        </div>

        <div class="class-card">
          <div class="class-header">
            <span class="class-subject">Computer Networks</span>
            <span class="class-time">04:00 PM</span>
          </div>
          <div class="class-details">
            <div><strong>Room:</strong> CS-102</div>
            <div><strong>Faculty:</strong> Dr. Anderson</div>
            <div><strong>Duration:</strong> 1 hour</div>
          </div>
          <div class="attendance-actions">
            <button class="attendance-btn btn-attend">Attend</button>
            <button class="attendance-btn btn-skip">Skip</button>
            <button class="attendance-btn btn-not-held">Not Held</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Periodical & grid content (unchanged) -->
    <section class="periodical-section">
      <header class="periodical-header"><h2>Periodical records</h2></header>
      <div class="date-picker-container">
        <div class="custom-flatpickr">
          <input type="text" placeholder="Select date range..." data-input id="rangePicker" />
          <div class="date-display" id="dateDisplay">
            <span class="date-part empty" id="startDate">Select date</span>
            <span class="date-separator">to</span>
            <span class="date-part empty" id="endDate">Select date</span>
          </div>
          <span class="calendar-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="#323544" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="3" y="4" width="18" height="18" rx="3" ry="3"></rect>
              <line x1="3" y1="10" x2="21" y2="10"></line>
              <line x1="8" y1="2" x2="8" y2="6"></line>
              <line x1="16" y1="2" x2="16" y2="6"></line>
            </svg>
          </span>
        </div>
        <p class="date-picker-helper">for selected period</p>
      </div>

      <section class="bento-grid">
        <article class="card metric-card span-2">
          <div class="card-title">Overall attendance</div>
          <div class="metric-icon" aria-hidden="true">
            <svg class="w-6 h-6" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#323544" viewBox="0 0 24 24">
              <path d="M13.5 2c-.178 0-.356.013-.492.022l-.074.005a1 1 0 0 0-.934.998V11a1 1 0 0 0 1 1h7.975a1 1 0 0 0 .998-.934l.005-.074A7.04 7.04 0 0 0 22 10.5A8.5 8.5 0 0 0 13.5 2Z"/>
              <path d="M11 6.025a1 1 0 0 0-1.065-.998 8.5 8.5 0 1 0 9.038 9.039A1 1 0 0 0 17.975 13H11V6.025Z"/>
            </svg>
          </div>
          <div class="card-body">
            <div class="circle-shell">
              <svg viewBox="0 0 140 140">
                <circle class="circle-outer-ring" cx="70" cy="70" r="60" />
                <circle class="circle-inner-value" cx="70" cy="70" r="48" />
              </svg>
              <div class="circle-center"><span>75%</span></div>
            </div>
            <div class="card-footer">All subjects combined</div>
          </div>
        </article>

        <article class="card metric-card span-2" id="majorCard">
          <div class="card-title">Major subs overall</div>
          <div class="metric-icon" aria-hidden="true">
            <svg width="24" height="25" viewBox="0 0 24 25" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M3.5 5.75C3.5 5.33579 3.16421 5 2.75 5C2.33579 5 2 5.33579 2 5.75V17.75C2 18.9926 3.00736 20 4.25 20H21.25C21.6642 20 22 19.6642 22 19.25C22 18.8358 21.6642 18.5 21.25 18.5H4.25C3.83579 18.5 3.5 18.1642 3.5 17.75V5.75Z" fill="#323544"/>
              <path d="M7 10.7773C5.89543 10.7773 5 11.6728 5 12.7773V16.2501C5 16.6643 5.33579 17.0001 5.75 17.0001H8.25C8.66421 17.0001 9 16.6643 9 16.2501V12.7773C9 11.6728 8.10457 10.7773 7 10.7773Z" fill="#323544"/>
              <path d="M12.5 5C11.3954 5 10.5 5.89543 10.5 7V16.2501C10.5 16.6643 10.8358 17.0001 11.25 17.0001H13.75C14.1642 17.0001 14.5 16.6643 14.5 16.2501V7C14.5 5.89543 13.6046 5 12.5 5Z" fill="#323544"/>
              <path d="M18 8.55859C16.8954 8.55859 16 9.45402 16 10.5586V16.2501C16 16.6643 16.3358 17.0001 16.75 17.0001H19.25C19.6642 17.0001 20 16.6643 20 16.2501V10.5586C20 9.45402 19.1046 8.55859 18 8.55859Z" fill="#323544"/>
            </svg>
          </div>
          <div class="major-edit-icon" id="majorEdit" title="Select major subjects">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#323544" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-pencil-discount">
              <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
              <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
              <path d="M13.5 6.5l4 4" />
              <path d="M16 21l5 -5" />
              <path d="M21 21v.01" />
              <path d="M16 16v.01" />
            </svg>
          </div>
          <div class="card-body">
            <div class="half-shell">
              <svg viewBox="0 0 140 80">
                <path class="half-outer-ring" d="M15 70 A55 55 0 0 1 125 70" />
                <path class="half-inner-value" id="majorHalfPath" d="M28 70 A40 40 0 0 1 112 70" />
              </svg>
              <div class="half-center-text" id="majorPercent">0%</div>
            </div>
            <div class="card-footer" id="majorFooter">Select major, click pencil button</div>
          </div>

          <div class="major-modal" id="majorModal">
            <div class="major-modal-content">
              <div class="major-modal-subtitle">Select major subjects to calculate major overall.</div>
              <div class="major-modal-list" id="majorList">
                <label><input type="checkbox" value="Mathematics" class="major-checkbox" /><span>Mathematics</span></label>
                <label><input type="checkbox" value="Physics" class="major-checkbox" /><span>Physics</span></label>
                <label><input type="checkbox" value="Chemistry" class="major-checkbox" /><span>Chemistry</span></label>
                <label><input type="checkbox" value="Computer Science" class="major-checkbox" /><span>Computer Science</span></label>
              </div>
              <div class="major-modal-actions">
                <button type="button" class="btn-ghost" id="majorCancel">Cancel</button>
                <button type="button" class="btn-primary" id="majorSave">Save</button>
              </div>
            </div>
          </div>
        </article>

        <article class="card info-card span-full">
          <div class="summary-header">
            <span class="summary-title">Attendance summary</span>
            <span class="summary-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none" stroke="#323544" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="4" width="18" height="14" rx="2"></rect>
                <path d="M7 9h10"></path>
                <path d="M7 13h4"></path>
              </svg>
            </span>
          </div>
          <div class="info-card-body" id="summaryBody">
            <ul>
              <li>Overall attendance is 75% for this period.</li>
              <li>Major subjects are not selected yet. Choose majors to track their combined attendance.</li>
            </ul>
          </div>
        </article>

        <!-- subjects cards unchanged -->
        <article class="card subject-card purple span-2">
          <div class="subject-header"><span class="subject-name">Mathematics</span><span class="subject-icon" aria-hidden="true">
            <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
              <path stroke="#323544" stroke-linejoin="round" d="m17 13 3.4641-2V7L17 5l-3.4641 2v4M17 13l-3.4641-2M17 13v4l-7.00001 4M17 13V9m0 4-7.00001 4m3.53591-6L10.5 12.7348M9.99999 21l-3.4641-2.1318M9.99999 21v-4m-3.4641 2v-.1318m0 0V15L10.5 12.7348m-3.96411 6.1334L3.5 17V5m0 0L7 3l3.5 2m-7 0 2.99999 2M10.5 5v7.7348M10.5 5 6.49999 7M17 9l3.5-2M17 9l-3.5-2M9.99999 17l-3.5-2m0 .5V7"/>
            </svg>
          </span></div>
          <div class="subject-meta-group"><div class="subject-meta">Total classes - 22</div><div class="subject-meta">Attended - 18</div></div>
          <div class="subject-percentage">82%</div>
        </article>

        <article class="card subject-card subject-2 span-2">
          <div class="subject-header"><span class="subject-name">Physics</span><span class="subject-icon" aria-hidden="true">
            <svg class="w-[38px] h-[38px]" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#323544" viewBox="0 0 24 24">
              <path d="M20 14h-2.722L11 20.278a5.511 5.511 0 0 1-.9.722H20a1 1 0 0 0 1-1v-5a1 1 0 0 0-1-1ZM9 3H4a1 1 0 0 0-1 1v13.5a3.5 3.5 0 1 0 7 0V4a1 1 0 0 0-1-1ZM6.5 18.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2ZM19.132 7.9 15.6 4.368a1 1 0 0 0-1.414 0L12 6.55v9.9l7.132-7.132a1 1 0 0 0 0-1.418Z"/>
            </svg>
          </span></div>
          <div class="subject-meta-group"><div class="subject-meta">Total classes - 20</div><div class="subject-meta">Attended - 15</div></div>
          <div class="subject-percentage">75%</div>
        </article>

        <article class="card subject-card mint span-2">
          <div class="subject-header"><span class="subject-name">Computer Science</span><span class="subject-icon" aria-hidden="true">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M11.9933 3.50879C11.6316 3.50879 11.2683 3.58158 10.9266 3.7263L3.4825 6.85273C3.06333 7.02875 3.07417 7.62121 3.4925 7.79726L10.9775 10.8086C11.6332 11.0786 12.3667 11.0786 13.0225 10.8086L20.5075 7.79726C20.9266 7.63137 20.9266 7.02875 20.5175 6.85273L13.0533 3.7263C12.7179 3.58228 12.3575 3.5083 11.9933 3.50879ZM21.5 8.66308C21.4365 8.6635 21.3736 8.67644 21.315 8.70117L12.9716 11.9825C12.8783 12.0213 12.7984 12.0874 12.742 12.1723C12.6857 12.2573 12.6554 12.3574 12.655 12.4598V19.989C12.6558 20.0714 12.6763 20.1524 12.7148 20.225C12.7533 20.2975 12.8087 20.3595 12.876 20.4055C12.9433 20.4515 13.0207 20.4801 13.1014 20.4889C13.1821 20.4978 13.2637 20.4865 13.3392 20.4562L21.6833 17.1639C21.7769 17.1286 21.8574 17.0649 21.9141 16.9814C21.9708 16.898 22.0007 16.7989 22 16.6975V9.16836C21.9991 9.03426 21.946 8.90598 21.8523 8.81146C21.7587 8.71694 21.632 8.66305 21.5 8.66308ZM2.56333 8.69609C2.48934 8.69343 2.41561 8.70634 2.34678 8.73399C2.27794 8.76166 2.21548 8.80352 2.16333 8.85688C2.07167 8.95082 2 9.06425 2 9.19965V16.271C2 16.645 2.42916 16.8947 2.75667 16.728L10.7116 12.8441C11.1 12.6579 11.07 12.0756 10.6608 11.9198L2.73583 8.73246C2.68113 8.70923 2.62262 8.69746 2.56333 8.69609Z" fill="#323544"/>
            </svg>
          </span></div>
          <div class="subject-meta-group"><div class="subject-meta">Total classes - 21</div><div class="subject-meta">Attended - 16</div></div>
          <div class="subject-percentage">76%</div>
        </article>

        <article class="card subject-card peach span-2">
          <div class="subject-header"><span class="subject-name">Computer Science</span><span class="subject-icon" aria-hidden="true">
            <svg class="w-[38px] h-[38px]" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#323544" viewBox="0 0 24 24">
              <path d="M3 4.92857C3 3.90506 3.80497 3 4.88889 3H19.1111C20.195 3 21 3.90506 21 4.92857V13h-3v-2c0-.5523-.4477-1-1-1h-4c-.5523 0-1 .4477-1 1v2H3V4.92857ZM3 15v1.0714C3 17.0949 3.80497 18 4.88889 18h3.47608L7.2318 19.3598c-.35356.4243-.29624 1.0548.12804 1.4084.42428.3536 1.05484.2962 1.40841-.128L10.9684 18h2.0632l2.2002 2.6402c.3535.4242.9841.4816 1.4084.128.4242-.3536.4816-.9841.128-1.4084L15.635 18h3.4761C20.195 18 21 17.0949 21 16.0714V15H3Z"/>
              <path d="M16 12v1h-2v-1h2Z"/>
            </svg>
          </span></div>
          <div class="subject-meta-group"><div class="subject-meta">Total classes - 14</div><div class="subject-meta">Attended - 11</div></div>
          <div class="subject-percentage">79%</div>
        </article>
      </section>
    </section>

    <!-- Date-wise Records section unchanged -->
    <section class="periodical-section" id="dateWiseRecordsSection">
      <header class="app-header">
        <div class="title-block"><h1>Date-wise Records</h1><span class="subtitle" id="selectedDateLabel">Loadingâ€¦</span></div>
        <div class="month-year-select">
          <span class="edit-icon" aria-hidden="true">
            <svg clip-rule="evenodd" fill-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path d="m19 20.25c0-.402-.356-.75-.75-.75-2.561 0-11.939 0-14.5 0-.394 0-.75.348-.75.75s.356.75.75.75h14.5c.394 0 .75-.348.75-.75zm-7.403-3.398 9.124-9.125c.171-.171.279-.423.279-.684 0-.229-.083-.466-.28-.662l-3.115-3.104c-.185-.185-.429-.277-.672-.277s-.486.092-.672.277l-9.143 9.103c-.569 1.763-1.555 4.823-1.626 5.081-.02.075-.029.15-.029.224 0 .461.349.848.765.848.511 0 .991-.189 5.369-1.681zm-3.27-3.342 2.137 2.137-3.168 1.046zm.955-1.166 7.651-7.616 2.335 2.327-7.637 7.638z"/>
            </svg>
          </span>
          <select id="monthYearSelect" aria-label="Month and year"></select>
        </div>
      </header>

      <section class="date-strip-wrapper" aria-label="Date picker">
        <div class="date-strip" id="dateStrip"></div>
      </section>

      <section class="cards-container" id="dateCardsContainer" aria-label="Attendance records"></section>
    </section>
  </div>

  <!-- Modals, AI board, Menu container, Result overlay â€” kept unchanged -->
  <div class="modal-backdrop hidden" id="editModal">
    <div class="modal">
      <h3>Edit record</h3>
      <div class="modal-subject" id="modalSubject"></div>
      <div class="form-group">
        <label for="modalStatus">Status</label>
        <select id="modalStatus">
          <option value="present">Present</option>
          <option value="absent">Absent</option>
          <option value="not-held">Class not held</option>
        </select>
      </div>
      <div class="form-group">
        <label for="modalRemarks">Remarks / Notes</label>
        <textarea id="modalRemarks" placeholder="Add your notes for this class"></textarea>
      </div>
      <div class="modal-actions">
        <button class="btn btn-secondary" id="modalCancel">Cancel</button>
        <button class="btn btn-primary" id="modalSave">Save changes</button>
      </div>
    </div>
  </div>

  <div class="ai-board-overlay">
    <div class="ai-board" id="aiBoard">
      <div class="ai-board-header">
        <h2 class="ai-title">Attenza AI</h2>
        <button class="ai-close-btn" id="aiCloseBtn" aria-label="Close AI">Ã—</button>
      </div>

      <div class="ai-board-body">
        <div class="ai-user-card-wrapper">
          <div class="ai-user-card" id="userMessageCard">Your question will appear here.</div>
        </div>

        <div class="ai-status-row">
          <div class="ai-status-loader"><div class="stripe"></div><div class="stripe"></div><div class="stripe"></div><div class="stripe"></div></div>
          <span class="ai-status-text" id="aiStatusText">Analyzingâ€¦</span>
        </div>

        <div class="ai-response" id="aiResponse">Here is a sample response from Attenza AI. Once you connect Gemini and your attendance backend, this will show real, detailed insights.</div>
        <button class="ai-copy-btn" id="aiCopyBtn"><span>ðŸ“‹</span><span>Copy</span></button>
      </div>
    </div>

    <div class="ai-card-container">
      <div class="see-more-btn">
        <div class="logo-loader-wrapper">
          <img src="Image/Ailogo.webp" alt="Attenza AI" class="ai-loader-webp" loading="lazy" decoding="async"/>
        </div>
        <span class="divider"></span>
        <div class="prompt-area" id="promptArea">
          <div class="prompt-display">
            <span class="typewriter-text" id="typewriterText"></span>
            <input type="text" id="promptInput" class="prompt-input" autocomplete="off" autocorrect="off" autocapitalize="sentences" spellcheck="false"/>
          </div>
          <button class="send-btn" id="sendBtn">
            <svg viewBox="0 0 24 24" style="width:22px; height:22px;">
              <path d="M12 5L18 11" stroke="white" stroke-width="2.4" stroke-linecap="round"/>
              <path d="M12 5L6 11" stroke="white" stroke-width="2.4" stroke-linecap="round"/>
              <path d="M12 5V19" stroke="white" stroke-width="2.4" stroke-linecap="round"/>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- MENU CONTAINER -->
  <section id="menuView" class="menu-view hidden" aria-hidden="true">
    <div id="view-menu" class="app-view">
      <div class="container-top">
        <div class="header-row">
          <h1 class="header-title">Menu</h1>
          <button id="closeMenuBtn" class="nav-btn" aria-label="Close Menu"><span class="material-symbols-rounded">close</span></button>
        </div>

        <div class="search-box" id="searchBoxContainer">
          <span class="material-symbols-rounded search-icon">search</span>
          <span class="search-prefix" id="searchPrefix">Roll â€“</span>
          <input type="tel" id="mainSearchInput" placeholder="Search any roll to check attendance" class="search-input" autocomplete="off">
          <div class="search-action-btn" id="actionBtn" onclick="activateSearchMode()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
              <line x1="5" y1="12" x2="19" y2="12"></line>
              <polyline points="12 5 19 12 12 19"></polyline>
            </svg>
          </div>
        </div>
      </div>

      <div class="container-scroll" id="scrollContent">
        <div class="menu-profile-card">
          <img src="https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80" class="menu-profile-img" alt="Profile">
          <div class="menu-profile-info">
            <h2 class="menu-profile-name">Johnathan Doe</h2>
            <p class="menu-profile-email">john.doe23@university.edu</p>
            <div class="profile-pills">
              <span class="pill pill-purple">Roll - 234</span>
              <span class="pill pill-purple">B.Com 1st Sem</span>
            </div>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="edit-icon">
              <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
              <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
              <path d="M13.5 6.5l4 4" />
              <path d="M16 21l5 -5" />
              <path d="M21 21v.01" />
              <path d="M16 16v.01" />
            </svg>
          </div>
        </div>

        <div class="menu-card" style="margin-bottom: 20px; padding-bottom: 15px;">
          <div class="menu-header">
            <span class="menu-header-text">Dispur College</span>
            <span class="material-symbols-rounded" style="color: #d1d5db; font-size: 18px;">school</span>
          </div>

          <div class="menu-item active" style="padding: 14px 16px;" onclick="window.location.href='setup.html'">
            <div class="status-dot"></div>
            <div class="menu-icon-box purple-bg">
              <span class="material-symbols-rounded" style="font-size: 18px;">library_add</span>
            </div>
            <div class="menu-text">
              <p class="menu-title">Select Subjects</p>
              <p class="menu-subtitle">Set up subjects to track attendance</p>
            </div>
            <span class="material-symbols-rounded chevron-active">chevron_right</span>
          </div>
        </div>

        <div class="menu-card">
          <a href="#" class="menu-item"><span class="material-symbols-rounded menu-icon-gray">badge</span><span class="menu-item-text">Important Staff</span><span class="material-symbols-rounded chevron">chevron_right</span></a>
          <div class="divider"></div>
          <a href="#" class="menu-item"><span class="material-symbols-rounded menu-icon-gray">group_add</span><span class="menu-item-text">Refer a Friend</span><span class="material-symbols-rounded chevron">chevron_right</span></a>
          <div class="divider"></div>
          <a href="#" class="menu-item"><span class="material-symbols-rounded menu-icon-gray">chat_bubble</span><span class="menu-item-text">Report Issue</span><span class="material-symbols-rounded chevron">chevron_right</span></a>
          <div class="divider"></div>
          <a href="#" class="menu-item"><span class="material-symbols-rounded menu-icon-gray">gpp_maybe</span><span class="menu-item-text">Terms & Privacy</span><span class="material-symbols-rounded chevron">chevron_right</span></a>
        </div>

        <div class="logout-section">
          <button class="btn-logout"><span class="material-symbols-rounded">logout</span> Log Out</button>
          <div class="version-text">Attenza Educational â€¢ v1.0.4</div>
        </div>
      </div>
    </div>
  </section>

  <div id="result-overlay-container">
    <div class="overlay-backdrop" onclick="exitSearchMode()"></div>
    <div class="result-wrapper">
      <div class="result-header">
        <span class="helper-text">Showing students from</span>
        <div class="dropdown-wrapper" id="classDropdown">
          <div class="class-pill" onclick="toggleDropdown()">
            <span id="selectedClassText">B.Com Sem 5</span>
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
          </div>

          <div class="dropdown-list">
            <div class="dropdown-item" onclick="selectClass('B.Com Sem 5')">B.Com Sem 5</div>
            <div class="dropdown-item" onclick="selectClass('B.Com Sem 3')">B.Com Sem 3</div>
            <div class="dropdown-item" onclick="selectClass('B.A. Sem 1')">B.A. Sem 1</div>
            <div class="dropdown-item" onclick="selectClass('H.S. 2nd Year')">H.S. 2nd Year</div>
          </div>
        </div>
      </div>

      <div class="result-card" id="foundState">
        <div class="card-left">
          <div class="avatar-box">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
          </div>
          <div class="info-group">
            <div class="student-name">Rahul Sharma</div>
            <div class="data-freshness"><span class="status-dot-result"></span> Updated 2h ago</div>
          </div>
        </div>
        <div class="card-right"><span class="percentage-val">78%</span><span class="percentage-label">Overall</span></div>
      </div>

      <div class="empty-card" id="emptyState">
        <div class="empty-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="8" x2="12" y2="12"></line>
            <line x1="12" y1="16" x2="12.01" y2="16"></line>
          </svg>
        </div>
        <div class="empty-title">No student found</div>
        <div class="empty-desc">Your classmates in this section are not using Attendmark yet.</div>
        <button class="invite-pill">Invite Friend
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="18" cy="5" r="3"></circle>
            <circle cx="6" cy="12" r="3"></circle>
            <circle cx="18" cy="19" r="3"></circle>
            <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
            <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- flatpickr -->
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

  <!-- Lightweight fallback UI script: ensures basic interactions work even if app.js errors -->
  <script>
    (function () {
      // Utility to toggle cls
      function toggleMenu(open) {
        const menuView = document.getElementById('menuView');
        if (!menuView) return;
        if (open) {
          menuView.classList.remove('hidden');
          menuView.setAttribute('aria-hidden', 'false');
        } else {
          menuView.classList.add('hidden');
          menuView.setAttribute('aria-hidden', 'true');
        }
      }

      // Menu open/close
      const openBtn = document.getElementById('openMenuBtn');
      const closeBtn = document.getElementById('closeMenuBtn');
      if (openBtn) openBtn.addEventListener('click', () => toggleMenu(true));
      if (closeBtn) closeBtn.addEventListener('click', () => toggleMenu(false));

      // Install strip close
      const closeStripBtn = document.getElementById('closeStrip');
      if (closeStripBtn) closeStripBtn.addEventListener('click', () => {
        const strip = document.getElementById('installStrip');
        if (strip) strip.style.display = 'none';
      });

      // Expand arrow toggle
      const expandArrow = document.getElementById('expandArrow');
      const expandedContent = document.getElementById('expandedContent');
      if (expandArrow && expandedContent) {
        expandArrow.addEventListener('click', () => {
          expandedContent.classList.toggle('open');
          expandArrow.classList.toggle('rotated');
        });
      }

      // Ensure page can scroll if some CSS accidentally prevents it
      try { document.documentElement.style.overflowY = 'auto'; } catch(e){}

      // Small helper to reveal body immediately if JS loaded after CSS hides it
      if (document.body && getComputedStyle(document.body).visibility === 'hidden') {
        // Reveal only if firebase script hasn't already taken control (auth check logic may later change visibility)
        document.body.style.visibility = 'visible';
      }
    })();
  </script>

  <!-- your app script (kept in place, loaded last) -->
  <script src="app.js"></script>
</body>
</html>
