<!DOCTYPE html>  
<html lang="en">  
<head>  
    <link rel="manifest" href="./manifest.json">
    <link rel="stylesheet" href="styles.css">  
    <meta name="theme-color" content="#8b7cc8">  
    <link rel="apple-touch-icon" href="./icons/icon-192.png">  
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">  
    <link href="https://fonts.googleapis.com/css2?family=Gaegu:wght@300;400;700&display=swap" rel="stylesheet">  
    <link href="https://fonts.googleapis.com/css2?family=Cedarville+Cursive&display=swap" rel="stylesheet">  
    <link href="https://fonts.googleapis.com/css2?family=Cabin+Sketch:wght@400;700&display=swap" rel="stylesheet">  

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">  

    <style>
      body {
        visibility: hidden;
      }
    </style>

    <title>ATTENZA - for Dispur College</title>  
        
    <script type="module">
      import { auth, db } from './firebase-init.js';
      import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
      // Add Firestore imports to check the profile
      import { doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";


      onAuthStateChanged(auth, async (user) => {
        if (!user) {
          // 1. Not Logged in? Go to login
          window.location.replace("login.html");
        } else {
          // 2. Logged in? Check if Profile exists before showing the page
          try {
            const userRef = doc(db, "users", user.uid);
            const userSnap = await getDoc(userRef);

            // Check if document exists AND profileComplete is true
            if (userSnap.exists() && userSnap.data().profileComplete === true) {
                 document.body.style.visibility = "visible";
            } else {
                 // 3. Logged in BUT incomplete registration? Go back to login/registration
                 window.location.replace("login.html");
            }
          } catch (error) {
            console.error("Auth Check Error:", error);
            // Safety fallback
            window.location.replace("login.html");
          }
        }
      });
    </script>
</head>  

<body>  
<div class="header" id="header">  
    <div class="top-bar">  
        <div class="left-section">  
            <button class="icon-btn" aria-label="Menu" onclick="openMenu()">  
                <div class="menu-mini"><span></span></div>  
            </button>  
            <div class="brand-container">  
                <span class="brand-name">ATTENZA</span>  
                <span class="tagline">a student driven attendance tracker</span>  
            </div>  
        </div>  

        <button class="icon-btn notif-rev" aria-label="Notifications">  
            <svg  
                viewBox="0 0 24 24"  
                fill="none"  
                xmlns="http://www.w3.org/2000/svg"  
                aria-hidden="true"  
            >  
                <path  
                    d="M12 5.365V3m0 2.365a5.338 5.338 0 0 1 5.133 5.368v1.8c0 2.386 1.867 2.982 1.867 4.175 0 .593 0 1.292-.538 1.292H5.538C5 18 5 17.301 5 16.708c0-1.193 1.867-1.789 1.867-4.175v-1.8A5.338 5.338 0 0 1 12 5.365ZM8.733 18c.094.852.306 1.54.944 2.112a3.48 3.48 0 0 0 4.646 0c.638-.572 1.236-1.26 1.33-2.112h-6.92Z"  
                    stroke-width="2.25"  
                    stroke-linejoin="round"  
                    stroke-linecap="round"  
                    stroke="currentColor"  
                ></path>  
            </svg>  
            <div class="notif-dot"></div>  
        </button>  
    </div>  
</div>  

<div class="expand-section">  
    <div class="expand-arrow" id="expandArrow">  
        <svg viewBox="0 0 24 24" fill="none">  
            <path d="M6 9l6 6 6-6" stroke-linecap="round" stroke-linejoin="round"/>  
        </svg>  
    </div>  

    <div class="expanded-content" id="expandedContent">  
        <div class="content-inner">  
            <div class="info-section">  
                <h3>About ATTENZA</h3>  
                <p>A student-driven attendance tracker designed exclusively for Dispur College students. View your attendance data anytime, anywhere - something our teacher-driven system doesn't allow.</p>  
            </div>  

            <div class="info-section">  
                <h3>Key Features</h3>  
                <div class="features">  
                    <div class="feature-card">  
                        <h4>ðŸ“Š Real-time Data</h4>  
                        <p>Check your attendance percentage instantly</p>  
                    </div>  
                    <div class="feature-card">  
                        <h4>ðŸ“… Subject-wise View</h4>  
                        <p>Track attendance for each subject separately</p>  
                    </div>  
                    <div class="feature-card">  
                        <h4>ðŸ”” Smart Alerts</h4>  
                        <p>Get notified when attendance falls below threshold</p>  
                    </div>  
                    <div class="feature-card">  
                        <h4>ðŸ“± Mobile Friendly</h4>  
                        <p>Access from any device, anytime</p>  
                    </div>  
                </div>  
            </div>  

            <div class="info-section">  
                <h3>How to Use</h3>  
                <p>1. Log in with your college ID<br>  
                    2. View your dashboard with attendance summary<br>  
                    3. Click on any subject to see detailed records<br>  
                    4. Set alerts for attendance warnings</p>  
            </div>  
        </div>  
    </div>  
</div>

<div class="sketch-line-container">  
    <span class="sketch-line">  
        I  
        <svg class="sketch-heart" viewBox="0 0 120 120">  
            <path d="M60 105  
                     C20 70, 10 40, 30 25  
                     C50 10, 70 20, 60 40  
                     C80 10, 110 25, 90 50  
                     C70 80, 60 95, 60 105 Z"/>  
            <g stroke="#e63946" stroke-width="4" fill="none" stroke-linecap="round" stroke-linejoin="round" opacity="0.9">  
                <path d="M35 60 Q 55 50 80 55" />  
                <path d="M32 68 Q 55 60 85 64" />  
                <path d="M34 76 Q 55 70 82 75" />  
                <path d="M37 84 Q 58 78 79 82" />  
                <path d="M45 45 Q 60 55 78 68" />  
                <path d="M40 52 Q 55 64 75 78" />  
                <path d="M50 70 Q 55 68 60 72" />  
                <path d="M58 80 Q 63 78 68 82" />  
            </g>  
        </svg>  
        Dispur College  
    </span>
</div>

<div class="content-body">  
    <div class="welcome-section">  
        <div class="welcome-content">  
            <div class="welcome-text-content">  
                <h3 id="welcomeTitle">Hello, User!</h3>  
                <p id="welcomeSubtitle">Great progress! Keep maintaining your attendance streak.</p>  
                <div class="attendance-ring">  
                    <svg class="ring-svg" viewBox="0 0 160 160">  
                        <circle class="ring-bg-circle" cx="80" cy="80" r="70"></circle>  
                        <circle class="ring-progress-circle" cx="80" cy="80" r="70" id="progressCircle"></circle>  
                    </svg>  
                    <div class="ring-center">  
                        <span class="percentage" id="percentageText">75%</span>  
                        <span class="percentage-label">Overall</span>  
                    </div>  
                </div>  
            </div>  
        </div>  
    </div>  
</div>  

<div class="notebook-section">  
    <div class="page">  
        <img src="Image/your-logo.png" alt="Logo" class="note-logo">  
        <div class="margin"></div>  

        <p>  
            Keep a quick note of important classes, make-up days or attendance targets here.  
            This space can work like your personal college notebook page.  
        </p>  

        <div class="teacher-mark">  
            <span class="teacher-sign">Principal</span>  
        </div>  
    </div>  
</div>  

<div class="install-strip" id="installStrip">  
    <div class="install-content">  
        <span class="install-text" id="installText">Install this site as an app</span>  
        <button class="close-strip" id="closeStrip">  
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">  
                <line x1="18" y1="6" x2="6" y2="18"></line>  
                <line x1="6" y1="6" x2="18" y2="18"></line>  
            </svg>  
        </button>  
    </div>  
</div>  

<div class="section-header">  
    <h3>Today's Schedule</h3>  
    <a href="#" class="view-all">  
        VIEW  
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">  
            <polyline points="9 18 15 12 9 6"></polyline>  
        </svg>  
    </a>  
</div>  

<div class="carousel-container">  
    <div class="carousel" id="carousel">  
        <!-- class-cards (unchanged UI) -->
        <div class="class-card">  
            <div class="class-header">  
                <span class="class-subject">Data Structures</span>  
                <span class="class-time">09:00 AM</span>  
            </div>  
            <div class="class-details">  
                <div><strong>Room:</strong> CS-301</div>  
                <div><strong>Faculty:</strong> Dr. Smith</div>  
                <div><strong>Duration:</strong> 1 hour</div>  
            </div>  
            <div class="attendance-actions">  
                <button class="attendance-btn btn-attend">Attend</button>  
                <button class="attendance-btn btn-skip">Skip</button>  
                <button class="attendance-btn btn-not-held">Not Held</button>  
            </div>  
        </div>  

        <div class="class-card">  
            <div class="class-header">  
                <span class="class-subject">Database Systems</span>  
                <span class="class-time">11:00 AM</span>  
            </div>  
            <div class="class-details">  
                <div><strong>Room:</strong> CS-205</div>  
                <div><strong>Faculty:</strong> Prof. Johnson</div>  
                <div><strong>Duration:</strong> 1.5 hours</div>  
            </div>  
            <div class="attendance-actions">  
                <button class="attendance-btn btn-attend">Attend</button>  
                <button class="attendance-btn btn-skip">Skip</button>  
                <button class="attendance-btn btn-not-held">Not Held</button>  
            </div>  
        </div>  

        <div class="class-card">  
            <div class="class-header">  
                <span class="class-subject">Web Development</span>  
                <span class="class-time">02:00 PM</span>  
            </div>  
            <div class="class-details">  
                <div><strong>Room:</strong> Lab-102</div>  
                <div><strong>Faculty:</strong> Ms. Williams</div>  
                <div><strong>Duration:</strong> 2 hours</div>  
            </div>  
            <div class="attendance-actions">  
                <button class="attendance-btn btn-attend">Attend</button>  
                <button class="attendance-btn btn-skip">Skip</button>  
                <button class="attendance-btn btn-not-held">Not Held</button>  
            </div>  
        </div>  

        <div class="class-card">  
            <div class="class-header">  
                <span class="class-subject">Computer Networks</span>  
                <span class="class-time">04:00 PM</span>  
            </div>  
            <div class="class-details">  
                <div><strong>Room:</strong> CS-102</div>  
                <div><strong>Faculty:</strong> Dr. Anderson</div>  
                <div><strong>Duration:</strong> 1 hour</div>  
            </div>  
            <div class="attendance-actions">  
                <button class="attendance-btn btn-attend">Attend</button>  
                <button class="attendance-btn btn-skip">Skip</button>  
                <button class="attendance-btn btn-not-held">Not Held</button>  
            </div>  
        </div>  
    </div>  
</div>  

<section class="periodical-section">  
    <header class="periodical-header">  
        <h2>Periodical records</h2>  
    </header>  

    <div class="date-picker-container">  
        <div class="custom-flatpickr">  
            <input type="text" placeholder="Select date range..." data-input id="rangePicker" />  
            <div class="date-display" id="dateDisplay">  
                <span class="date-part empty" id="startDate">Select date</span>  
                <span class="date-separator">to</span>  
                <span class="date-part empty" id="endDate">Select date</span>  
            </div>  
            <span class="calendar-icon" aria-hidden="true">  
                <svg viewBox="0 0 24 24" fill="none" stroke="#323544" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">  
                    <rect x="3" y="4" width="18" height="18" rx="3" ry="3"></rect>  
                    <line x1="3" y1="10" x2="21" y2="10"></line>  
                    <line x1="8" y1="2" x2="8" y2="6"></line>  
                    <line x1="16" y1="2" x2="16" y2="6"></line>  
                </svg>  
            </span>  
        </div>  
        <p class="date-picker-helper">for selected period</p>  
    </div>  

    <section class="bento-grid">  
        <!-- metric cards and subject cards unchanged -->
        <article class="card metric-card span-2">  
            <div class="card-title">Overall attendance</div>  
            <div class="metric-icon" aria-hidden="true">  
                <svg class="w-6 h-6" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#323544" viewBox="0 0 24 24">  
                    <path d="M13.5 2c-.178 0-.356.013-.492.022l-.074.005a1 1 0 0 0-.934.998V11a1 1 0 0 0 1 1h7.975a1 1 0 0 0 .998-.934l.005-.074A7.04 7.04 0 0 0 22 10.5A8.5 8.5 0 0 0 13.5 2Z"/>  
                    <path d="M11 6.025a1 1 0 0 0-1.065-.998 8.5 8.5 0 1 0 9.038 9.039A1 1 0 0 0 17.975 13H11V6.025Z"/>  
                </svg>  
            </div>  
            <div class="card-body">  
                <div class="circle-shell">  
                    <svg viewBox="0 0 140 140">  
                        <circle class="circle-outer-ring" cx="70" cy="70" r="60" />  
                        <circle class="circle-inner-value" cx="70" cy="70" r="48" />  
                    </svg>  
                    <div class="circle-center"><span>75%</span></div>  
                </div>  
                <div class="card-footer">All subjects combined</div>  
            </div>  
        </article>  

        <article class="card metric-card span-2" id="majorCard">  
            <div class="card-title">Major subs overall</div>  
            <div class="metric-icon" aria-hidden="true">  
                <!-- svg omitted for brevity (unchanged) -->
            </div>  

            <div class="major-edit-icon" id="majorEdit" title="Select major subjects">  
                <!-- svg omitted for brevity (unchanged) -->
            </div>  

            <div class="card-body">  
                <div class="half-shell">  
                    <svg viewBox="0 0 140 80">  
                        <path class="half-outer-ring" d="M15 70 A55 55 0 0 1 125 70" />  
                        <path class="half-inner-value" id="majorHalfPath" d="M28 70 A40 40 0 0 1 112 70" />  
                    </svg>  
                    <div class="half-center-text" id="majorPercent">0%</div>  
                </div>  
                <div class="card-footer" id="majorFooter">Select major, click pencil button</div>  
            </div>  
        </article>  

        <article class="card info-card span-full">  
            <div class="summary-header">  
                <span class="summary-title">Attendance summary</span>  
                <span class="summary-icon" aria-hidden="true">  
                  <svg viewBox="0 0 24 24" fill="none" stroke="#323544" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">  
                    <rect x="3" y="4" width="18" height="14" rx="2"></rect>  
                    <path d="M7 9h10"></path>  
                    <path d="M7 13h4"></path>  
                  </svg>  
                </span>  
            </div>  
            <div class="info-card-body" id="summaryBody">  
                <ul>  
                    <li>Overall attendance is 75% for this period.</li>  
                    <li>Major subjects are not selected yet. Choose majors to track their combined attendance.</li>  
                </ul>  
            </div>  
        </article>  

        <!-- subject cards omitted here for brevity but unchanged in UI -->
    </section>  
</section>

<section class="periodical-section" id="dateWiseRecordsSection">
    <header class="app-header">
        <div class="title-block">
            <h1>Date-wise Records</h1>
            <span class="subtitle" id="selectedDateLabel">Loadingâ€¦</span>
        </div>

        <div class="month-year-select">
            <span class="edit-icon" aria-hidden="true">
                <svg clip-rule="evenodd" fill-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="m19 20.25c0-.402-.356-.75-.75-.75-2.561 0-11.939 0-14.5 0-.394 0-.75.348-.75.75s.356.75.75.75h14.5c.394 0 .75-.348.75-.75zm-7.403-3.398 9.124-9.125c.171-.171.279-.423.279-.684 0-.229-.083-.466-.28-.662l-3.115-3.104c-.185-.185-.429-.277-.672-.277s-.486.092-.672.277l-9.143 9.103c-.569 1.763-1.555 4.823-1.626 5.081-.02.075-.029.15-.029.224 0 .461.349.848.765.848.511 0 .991-.189 5.369-1.681zm-3.27-3.342 2.137 2.137-3.168 1.046zm.955-1.166 7.651-7.616 2.335 2.327-7.637 7.638z" />
                </svg>
            </span>
            <select id="monthYearSelect" aria-label="Month and year"></select>
        </div>
    </header>

    <section class="date-strip-wrapper" aria-label="Date picker">
        <div class="date-strip" id="dateStrip"></div>
    </section>

    <section class="cards-container" id="dateCardsContainer" aria-label="Attendance records"></section>
</section>

<div class="modal-backdrop hidden" id="editModal">
    <div class="modal">
        <h3>Edit record</h3>
        <div class="modal-subject" id="modalSubject"></div>

        <div class="form-group">
            <label for="modalStatus">Status</label>
            <select id="modalStatus">
                <option value="present">Present</option>
                <option value="absent">Absent</option>
                <option value="not-held">Class not held</option>
            </select>
        </div>

        <div class="form-group">
            <label for="modalRemarks">Remarks / Notes</label>
            <textarea id="modalRemarks" placeholder="Add your notes for this class"></textarea>
        </div>

        <div class="modal-actions">
            <button class="btn btn-secondary" id="modalCancel">Cancel</button>
            <button class="btn btn-primary" id="modalSave">Save changes</button>
        </div>
    </div>
</div>

<div class="ai-board-overlay">  
    <div class="ai-board" id="aiBoard">  
        <div class="ai-board-header">  
            <h2 class="ai-title">Attenza AI</h2>  
            <button class="ai-close-btn" id="aiCloseBtn" aria-label="Close AI">Ã—</button>  
        </div>  
        <div class="ai-board-body">  
            <div class="ai-user-card-wrapper">  
                <div class="ai-user-card" id="userMessageCard">  
                    Your question will appear here.  
                </div>  
            </div>  

            <div class="ai-status-row">  
                <div class="ai-status-loader">  
                    <div class="stripe"></div>  
                    <div class="stripe"></div>  
                    <div class="stripe"></div>  
                    <div class="stripe"></div>  
                </div>  
                <span class="ai-status-text" id="aiStatusText">Analyzingâ€¦</span>  
            </div>  

            <div class="ai-response" id="aiResponse">
                Here is a sample response from Attenza AI.

                Once you connect Gemini and your attendance backend, this will show real, detailed insights.
            </div>

            <button class="ai-copy-btn" id="aiCopyBtn">  
                <span>ðŸ“‹</span>  
                <span>Copy</span>  
            </button>  
        </div>  
    </div>  
</div>

<div class="ai-card-container">
  <div class="see-more-btn">
    <div class="logo-loader-wrapper">
      <img src="Image/Ailogo.webp" alt="Attenza AI" class="ai-loader-webp" loading="lazy" decoding="async"/>
    </div>

    <span class="divider"></span>

    <div class="prompt-area" id="promptArea">
      <div class="prompt-display">
        <span class="typewriter-text" id="typewriterText"></span>
        <input type="text" id="promptInput" class="prompt-input" autocomplete="off" autocorrect="off" autocapitalize="sentences" spellcheck="false"/>
      </div>

      <button class="send-btn" id="sendBtn">
        <svg viewBox="0 0 24 24" style="width:22px; height:22px;">
          <path d="M12 5L18 11" stroke="white" stroke-width="2.4" stroke-linecap="round"/>
          <path d="M12 5L6 11" stroke="white" stroke-width="2.4" stroke-linecap="round"/>
          <path d="M12 5V19" stroke="white" stroke-width="2.4" stroke-linecap="round"/>
        </svg>
      </button>
    </div>
  </div>
</div>

<!-- MENU OVERLAY -->
<div id="menuOverlay" style="
  position: fixed;
  top: 0;
  left: -100%;
  width: 100vw;
  height: 100vh;
  z-index: 9999;
  background: transparent;
  transition: left 0.35s cubic-bezier(0.4, 0, 0.2, 1);
">
  <iframe 
    src="menu.html"
    style="
      width: 100%;
      height: 100%;
      border: none;
      background: #F9F8F6;
    ">
  </iframe>
</div>

<!-- flatpickr (kept as external CDN) -->
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<!-- your JavaScript (moved to external file) -->
<script src="app.js"></script>

</body>  
</html>
